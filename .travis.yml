language: elixir

addons:
  postgresql: '9.6'

env:
  global:
    - CI=true
    - PGDATABASE=packages_bot
    - PGUSER=postgres
    - PGPASSWORD=postgres
    - PGHOST=localhost
    - DATABASE_URL=postgres://postgres:postgres@localhost/packages_bot
    - ARCHIVE_RENEW_INTERVAL_IN_SECONDS=3600
    - MELPA_BOT_TOKEN=fake_token
    - HEXPM_BOT_TOKEN=fake_token
    - RUBY_GEMS_BOT_TOKEN=fake_token
    - MIX_ENV=test

cache:
  directories:
    - "~/.hex"
    - "~/.mix"
    - deps

elixir:
  - '1.8'

otp_release:
  - '21.0'

before_script:
  - mix ecto.setup

script:
  - mix format --check-formatted
  - mix credo --strict
  - mix test
  - mix coveralls.travis --pro

services:
  - postgresql

deploy:
  provider: heroku
  app: packages-bot
  strategy: git
  api_key:
    secure: GvqUBspoKPYYXAu8GNvSuBdNNpYo4nauC7i9GTgeiKXRmEKYH03EQE5IxF1mbr2o6ZngFm2iy23XUX8DtWVXL+4OnI1e3RfMk2FkADiJHxZoa2SWLz3n6rBWPVYcmHJxJ7Gof0hhV77o0nX5JowWDmeIzqBH87sUEuS6LO2iLVrvZrlrByO80gCae8zFgPOZyNhXRXY3J/ynejs8H4yK8rKR0RYhtuCB9PGR35V0MNZHMT0R5ZR16Sd8w1By6jtmgAbd5vjB4ybyZS8gdMR7VhB2qdTAf9qW13MheEUzDPejB01ILqjvJCquzAUJhbhfoKlHWdGdb+0VN7+GJNnxI6T9kN9tJqBs4jSkN9bfIAnqQ/Yxjahxx0n17Q0FpSuztJ4DIwpYa/u5hqBLkqR6sfMOe4E1/OrZBe03Qv+AiuaxTsSSMVJa2tvVbX+XZDkuusdcL75edOTr0le2jVqsEH9UBxWXS+P5qT16mvDugjMhss5odYUz8yAq5sXF5FgeD+vJnEc2IWkO5DXoK1hplDnilYmCFU/Yc2EeTcbLof0TVgmkgTqoWUGG9qsG2eDfMtLH+jztQ/c7eKQrzHLF8PYNteusvi1QWNM2vl6d2uvDLM+w2w/WdIKtvV1aLlXXSiSVd1V2cKrJ2kmNsitLXyKIEYBO21qnzhGoUjZATEs=
